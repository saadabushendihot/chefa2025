<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة المعلم - إدارة الطلاب والدروس</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* Material Design Variables */
    :root {
      --primary-color: #6200ee;
      --primary-dark: #3700b3;
      --primary-light: #bb86fc;
      --secondary-color: #03dac6;
      --secondary-dark: #018786;
      --background: #ffffff;
      --surface: #ffffff;
      --error: #b00020;
      --on-primary: #ffffff;
      --on-secondary: #000000;
      --on-background: #000000;
      --on-surface: #000000;
      --on-error: #ffffff;
      --text-primary: rgba(0, 0, 0, 0.87);
      --text-secondary: rgba(0, 0, 0, 0.6);
      --text-hint: rgba(0, 0, 0, 0.38);
      --divider: rgba(0, 0, 0, 0.12);
      --elevation-1: 0 2px 1px -1px rgba(0,0,0,0.2), 0 1px 1px 0 rgba(0,0,0,0.14), 0 1px 3px 0 rgba(0,0,0,0.12);
      --elevation-2: 0 3px 1px -2px rgba(0,0,0,0.2), 0 2px 2px 0 rgba(0,0,0,0.14), 0 1px 5px 0 rgba(0,0,0,0.12);
      --elevation-4: 0 2px 4px -1px rgba(0,0,0,0.2), 0 4px 5px 0 rgba(0,0,0,0.14), 0 1px 10px 0 rgba(0,0,0,0.12);
      --elevation-8: 0 5px 5px -3px rgba(0,0,0,0.2), 0 8px 10px 1px rgba(0,0,0,0.14), 0 3px 14px 2px rgba(0,0,0,0.12);
    }

    /* Dark Mode Variables */
    .dark-mode {
      --primary-color: #bb86fc;
      --primary-dark: #3700b3;
      --secondary-color: #03dac6;
      --secondary-dark: #018786;
      --background: #121212;
      --surface: #1e1e1e;
      --error: #cf6679;
      --on-primary: #000000;
      --on-secondary: #000000;
      --on-background: #ffffff;
      --on-surface: #ffffff;
      --on-error: #000000;
      --text-primary: rgba(255, 255, 255, 0.87);
      --text-secondary: rgba(255, 255, 255, 0.6);
      --text-hint: rgba(255, 255, 255, 0.38);
      --divider: rgba(255, 255, 255, 0.12);
    }

    /* Base Styles */
    body {
      font-family: 'Tajawal', 'Roboto', sans-serif;
      margin: 0;
      background-color: var(--background);
      color: var(--text-primary);
      min-height: 100vh;
      padding-top: 64px;
      line-height: 1.5;
      font-size: 16px;
    }

    /* Material Typography */
    h1 { font-size: 2.125rem; font-weight: 400; line-height: 2.5rem; }
    h2 { font-size: 1.5rem; font-weight: 500; line-height: 2rem; }
    h3 { font-size: 1.25rem; font-weight: 500; line-height: 1.75rem; }
    h4 { font-size: 1rem; font-weight: 500; line-height: 1.5rem; letter-spacing: 0.15px; }
    h5 { font-size: 0.875rem; font-weight: 500; line-height: 1.5rem; letter-spacing: 0.1px; }
    h6 { font-size: 0.75rem; font-weight: 500; line-height: 1.25rem; letter-spacing: 0.1px; }
    .subtitle-1 { font-size: 1rem; font-weight: 400; line-height: 1.5rem; letter-spacing: 0.15px; }
    .subtitle-2 { font-size: 0.875rem; font-weight: 500; line-height: 1.5rem; letter-spacing: 0.1px; }
    .body-1 { font-size: 1rem; font-weight: 400; line-height: 1.5rem; letter-spacing: 0.5px; }
    .body-2 { font-size: 0.875rem; font-weight: 400; line-height: 1.25rem; letter-spacing: 0.25px; }
    .caption { font-size: 0.75rem; font-weight: 400; line-height: 1.25rem; letter-spacing: 0.4px; }
    .overline { font-size: 0.625rem; font-weight: 400; line-height: 1.5rem; letter-spacing: 1.5px; text-transform: uppercase; }

    /* App Bar */
    .app-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      background-color: var(--primary-color);
      color: var(--on-primary);
      display: flex;
      align-items: center;
      padding: 0 16px;
      box-shadow: var(--elevation-4);
      z-index: 1000;
    }

    .app-bar-title {
      font-size: 1.25rem;
      font-weight: 500;
      margin-right: 16px;
      white-space: nowrap;
    }

    .app-bar-logo {
      height: 40px;
      margin-left: 16px;
    }

    .app-bar-spacer {
      flex-grow: 1;
    }

    /* Navigation */
    .nav-link {
      color: var(--on-primary);
      text-decoration: none;
      padding: 0 16px;
      height: 64px;
      display: inline-flex;
      align-items: center;
      position: relative;
      transition: background-color 0.2s ease;
    }

    .nav-link:hover {
      background-color: rgba(255, 255, 255, 0.08);
    }

    .nav-link.active {
      background-color: rgba(255, 255, 255, 0.12);
    }

    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 16px;
      left: 16px;
      height: 2px;
      background-color: var(--secondary-color);
    }

    /* Material Buttons */
    .btn {
      min-width: 64px;
      height: 36px;
      padding: 0 16px;
      border-radius: 4px;
      font-size: 0.875rem;
      font-weight: 500;
      letter-spacing: 0.0892857143em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      outline: none;
      position: relative;
      overflow: hidden;
      transition: all 0.2s ease;
      background-color: var(--primary-color);
      color: var(--on-primary);
      box-shadow: var(--elevation-2);
    }

    .btn:hover {
      box-shadow: var(--elevation-4);
    }

    .btn:active {
      box-shadow: var(--elevation-8);
    }

    .btn:disabled {
      background-color: rgba(0, 0, 0, 0.12);
      color: rgba(0, 0, 0, 0.38);
      box-shadow: none;
      cursor: default;
    }

    .btn-text {
      background-color: transparent;
      color: var(--primary-color);
      box-shadow: none;
    }

    .btn-text:hover {
      background-color: rgba(98, 0, 238, 0.04);
      box-shadow: none;
    }

    .btn-outlined {
      background-color: transparent;
      color: var(--primary-color);
      border: 1px solid rgba(0, 0, 0, 0.12);
      box-shadow: none;
    }

    .btn-outlined:hover {
      background-color: rgba(98, 0, 238, 0.04);
      box-shadow: none;
    }

    .btn-danger {
      background-color: var(--error);
      color: var(--on-error);
    }

    .btn-danger:hover {
      background-color: #9b0000;
    }

    .btn-success {
      background-color: var(--secondary-color);
      color: var(--on-secondary);
    }

    .btn-success:hover {
      background-color: var(--secondary-dark);
    }

    /* Cards */
    .card {
      background-color: var(--surface);
      border-radius: 4px;
      box-shadow: var(--elevation-1);
      margin-bottom: 16px;
      overflow: hidden;
      transition: box-shadow 0.2s ease;
    }

    .card:hover {
      box-shadow: var(--elevation-2);
    }

    .card-header {
      padding: 16px;
      border-bottom: 1px solid var(--divider);
    }

    .card-content {
      padding: 16px;
    }

    .card-actions {
      padding: 8px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      border-top: 1px solid var(--divider);
    }

    /* Forms */
    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 4px;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .form-control {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--divider);
      border-radius: 4px;
      font-size: 1rem;
      background-color: var(--surface);
      color: var(--text-primary);
      transition: border-color 0.2s ease;
    }

    .form-control:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    .form-select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23000000'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 24px;
      padding-right: 32px;
    }

    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }

    /* Tables */
    .table-container {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin: 16px 0;
      border-radius: 4px;
      box-shadow: var(--elevation-1);
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    .table th {
      background-color: var(--primary-color);
      color: var(--on-primary);
      font-weight: 500;
      text-align: right;
      padding: 12px 16px;
      position: sticky;
      top: 0;
    }

    .table td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--divider);
      text-align: right;
    }

    .table tr:last-child td {
      border-bottom: none;
    }

    .table tr:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }

    /* Levels Grid */
    .levels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      margin-top: 16px;
    }

    .level-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--divider);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .level-item:hover {
      box-shadow: var(--elevation-1);
    }

    .level-item input[type="checkbox"] {
      margin-left: 8px;
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--primary-color);
    }

    .level-item label {
      flex-grow: 1;
      cursor: pointer;
    }

    /* Notification Bell */
    .notification-bell {
      position: relative;
      margin-left: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .notification-bell:hover {
      background-color: rgba(255, 255, 255, 0.08);
    }

    .notification-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background-color: var(--error);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }

    /* Notification Panel */
    .notification-panel {
      display: none;
      position: fixed;
      top: 64px;
      right: 16px;
      width: 360px;
      max-height: calc(100vh - 80px);
      background-color: var(--surface);
      border-radius: 4px;
      box-shadow: var(--elevation-8);
      z-index: 1100;
      overflow-y: auto;
      animation: slideInFromTop 0.3s ease-out;
    }

    @keyframes slideInFromTop {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .notification-header {
      padding: 16px;
      border-bottom: 1px solid var(--divider);
    }

    .notification-item {
      padding: 12px 16px;
      border-bottom: 1px solid var(--divider);
    }

    .notification-item.unread {
      background-color: rgba(98, 0, 238, 0.08);
    }

    .notification-item:last-child {
      border-bottom: none;
    }

    .notification-timestamp {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 12px 24px;
      background-color: #323232;
      color: white;
      border-radius: 4px;
      box-shadow: var(--elevation-6);
      z-index: 1200;
      opacity: 0;
      transform: translateY(100px);
      transition: all 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Spinner */
    .spinner {
      display: none;
      width: 40px;
      height: 40px;
      margin: 20px auto;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Utility Classes */
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .text-left { text-align: left; }
    .mt-1 { margin-top: 4px; }
    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 16px; }
    .mt-4 { margin-top: 24px; }
    .mt-5 { margin-top: 32px; }
    .mb-1 { margin-bottom: 4px; }
    .mb-2 { margin-bottom: 8px; }
    .mb-3 { margin-bottom: 16px; }
    .mb-4 { margin-bottom: 24px; }
    .mb-5 { margin-bottom: 32px; }
    .d-none { display: none; }
    .d-flex { display: flex; }
    .align-items-center { align-items: center; }
    .justify-content-between { justify-content: space-between; }

    /* Responsive Adjustments */
    @media (max-width: 960px) {
      body {
        padding-top: 56px;
      }
      
      .app-bar {
        height: 56px;
      }
      
      .nav-link {
        height: 56px;
        padding: 0 12px;
        font-size: 0.875rem;
      }
      
      .notification-panel {
        top: 56px;
        width: 320px;
      }
    }

    @media (max-width: 600px) {
      .app-bar-title {
        display: none;
      }
      
      .levels-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
      
      .card-content {
        padding: 12px;
      }
      
      .table th,
      .table td {
        padding: 8px 12px;
      }
      
      .notification-panel {
        width: calc(100% - 32px);
        right: 16px;
        left: 16px;
      }
    }

    /* Dark Mode Overrides */
    .dark-mode .form-control {
      background-color: var(--surface);
      border-color: var(--divider);
      color: var(--text-primary);
    }
    
    .dark-mode .form-select {
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23ffffff'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    }
    
    .dark-mode .table tr:hover {
      background-color: rgba(255, 255, 255, 0.04);
    }
    
    .dark-mode .level-item:hover {
      background-color: rgba(255, 255, 255, 0.04);
    }
    
    .dark-mode .notification-item.unread {
      background-color: rgba(187, 134, 252, 0.08);
    }
  </style>
</head>
<body>
  <!-- App Bar -->
  <header class="app-bar">
    <img src="https://i.ibb.co/cSpS2NDk/logo-1.png" alt="شعار المركز" class="app-bar-logo">
    <h1 class="app-bar-title">لوحة المعلم - إدارة الطلاب والدروس</h1>
    <div class="app-bar-spacer"></div>
    <nav>
      <a href="dashboard.html" class="nav-link active">لوحة التحكم</a>
      <a href="questions-admin.html" class="nav-link">إدارة الأسئلة</a>
    </nav>
    <div class="d-flex align-items-center">
      <div class="notification-bell" onclick="toggleTeacherNotificationPanel()">
        <i class="material-icons">notifications</i>
        <span id="unreadTeacherNotificationsBadge" class="notification-badge d-none">0</span>
      </div>
      <button class="btn btn-danger ml-2" onclick="logout()">
        <i class="material-icons mr-1">logout</i> تسجيل الخروج
      </button>
    </div>
  </header>

  <!-- Notification Panel -->
  <div id="teacherNotificationPanel" class="notification-panel">
    <div class="notification-header">
      <h5>إشعارات الطلاب</h5>
    </div>
    <div id="teacherNotificationsList">
      <p class="text-center" style="color: var(--text-secondary); padding: 16px;">لا توجد إشعارات حالياً.</p>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container" style="max-width: 1200px; margin: 16px auto; padding: 0 16px;">
    <div class="spinner" id="loadingSpinner"></div>
    <div id="toast" class="toast"></div>

    <!-- Add Student Card -->
    <div class="card">
      <div class="card-header d-flex align-items-center justify-content-between" style="cursor: pointer;" onclick="toggleSection('addStudentSection')">
        <h4 class="mb-0">إضافة طالب جديد</h4>
        <i class="material-icons" id="addStudentToggleIcon">add</i>
      </div>
      <div class="card-content" id="addStudentSection" style="display: none;">
        <form id="addStudentForm" onsubmit="addStudent(event)">
          <div class="form-group">
            <label for="studentEmail" class="form-label">البريد الإلكتروني</label>
            <input type="email" id="studentEmail" class="form-control" placeholder="student@email.com" required>
          </div>
          <div class="form-group">
            <label for="studentName" class="form-label">اسم الطالب</label>
            <input type="text" id="studentName" class="form-control" placeholder="اسم الطالب" required>
          </div>
          <div class="form-group">
            <label for="courseNumber" class="form-label">رقم الدورة</label>
            <input type="text" id="courseNumber" class="form-control" placeholder="رقم الدورة" required>
          </div>
          <div class="card-actions">
            <button class="btn" type="submit">إضافة الطالب</button>
          </div>
        </form>
        <div id="addStudentMsg" class="mt-2"></div>
      </div>
    </div>

    <!-- Add Lesson Card -->
    <div class="card mt-3">
      <div class="card-header d-flex align-items-center justify-content-between" style="cursor: pointer;" onclick="toggleSection('addLessonSection')">
        <h4 class="mb-0">إضافة درس جديد</h4>
        <i class="material-icons" id="addLessonToggleIcon">add</i>
      </div>
      <div class="card-content" id="addLessonSection" style="display: none;">
        <form id="addLessonForm" onsubmit="addLesson(event)">
          <div class="form-group">
            <label for="lessonId" class="form-label">رقم الدرس</label>
            <input type="number" id="lessonId" class="form-control" placeholder="مثال: 1" required min="1">
          </div>
          <div class="form-group">
            <label for="lessonTitle" class="form-label">عنوان الدرس</label>
            <input type="text" id="lessonTitle" class="form-control" placeholder="عنوان الدرس" required>
          </div>
          <div class="form-group">
            <label for="lessonUrl" class="form-label">رابط الدرس (للتنزيل)</label>
            <input type="text" id="lessonUrl" class="form-control" placeholder="رابط التحميل" required>
          </div>
          <div class="form-group">
            <label for="lessonVoice" class="form-label">رابط الصوت (للاستماع)</label>
            <input type="text" id="lessonVoice" class="form-control" placeholder="رابط الصوت (mp3 أو غيره)">
          </div>
          <div class="form-group">
            <label for="lessonLevel" class="form-label">المستوى</label>
            <input type="text" id="lessonLevel" class="form-control" placeholder='مثال: "الأول"' required>
          </div>
          <div class="card-actions">
            <button class="btn" type="submit">إضافة الدرس</button>
          </div>
        </form>
        <div id="addLessonMsg" class="mt-2"></div>
      </div>
    </div>

    <!-- Send Notification Card -->
    <div class="card mt-3">
      <div class="card-header d-flex align-items-center justify-content-between" style="cursor: pointer;" onclick="toggleSection('sendNotificationSection')">
        <h4 class="mb-0">إرسال إشعار جديد</h4>
        <i class="material-icons" id="sendNotificationToggleIcon">notifications</i>
      </div>
      <div class="card-content" id="sendNotificationSection" style="display: none;">
        <form id="sendNotificationForm" onsubmit="sendNotification(event)">
          <div class="form-group">
            <label for="notificationMessage" class="form-label">رسالة الإشعار:</label>
            <textarea id="notificationMessage" class="form-control" placeholder="اكتب رسالة الإشعار هنا..." required></textarea>
          </div>
          <div class="form-group">
            <label for="notificationRecipient" class="form-label">إرسال إلى:</label>
            <select id="notificationRecipient" class="form-control form-select">
              <option value="selectedStudent">الطالب المحدد حالياً</option>
              <option value="allStudents">جميع الطلاب</option>
            </select>
          </div>
          <div class="card-actions">
            <button class="btn" type="submit">إرسال الإشعار</button>
          </div>
        </form>
        <div id="addNotificationMsg" class="mt-2"></div>
      </div>
    </div>

    <!-- Students Management Card -->
    <div class="card mt-3">
      <div class="card-header">
        <h3>إدارة مستويات الطلاب</h3>
      </div>
      <div class="card-content">
        <div id="msg" class="mb-3"></div>
        
        <div class="form-group">
          <label for="studentSearch" class="form-label">بحث عن الطلاب:</label>
          <input type="text" id="studentSearch" class="form-control" placeholder="ابحث باسم الطالب أو بريده..." onkeyup="filterStudents()">
        </div>
        
        <div class="form-group">
          <label for="studentSelect" class="form-label">اختر الطالب:</label>
          <select id="studentSelect" class="form-control form-select" onchange="showSelectedStudentDetails(this.value)">
            <option value="">-- اختر طالباً لعرض بياناته --</option>
          </select>
        </div>
        
        <div id="selectedStudentDetails" style="display: none;">
          <div class="d-flex justify-content-between mt-4 mb-3">
            <button class="btn btn-danger" id="deleteStudentBtn" onclick="confirmDeleteStudent()">حذف الطالب</button>
            <button class="btn" id="teacherPDFBtn" onclick="downloadStudentReport()">تصدير نتائج الطالب PDF</button>
          </div>
          
          <h4 class="mt-4">تفاصيل الطالب المحدد:</h4>
          <div class="table-container">
            <table class="table">
              <tbody>
                <tr>
                  <td><strong>الاسم:</strong></td>
                  <td id="detailName"></td>
                </tr>
                <tr>
                  <td><strong>البريد الإلكتروني:</strong></td>
                  <td id="detailEmail"></td>
                </tr>
                <tr>
                  <td><strong>رقم الدورة:</strong></td>
                  <td id="detailCourseNumber"></td>
                </tr>
                <tr>
                  <td><strong>حالة القبول:</strong></td>
                  <td>
                    <select id="detailAcceptedStatus" class="form-control form-select" onchange="updateStudentAdmission(this.value)" style="width: auto; display: inline-block;">
                      <option value="pending">قيد المراجعة</option>
                      <option value="accepted">مقبول</option>
                      <option value="rejected">مرفوض</option>
                    </select>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="form-group mt-3">
            <label for="detailTeacherNotes" class="form-label">ملاحظات المعلم:</label>
            <textarea id="detailTeacherNotes" class="form-control" onblur="saveTeacherNotes()"></textarea>
            <button class="btn mt-2" onclick="saveTeacherNotes()">حفظ الملاحظات</button>
          </div>
          
          <h4 class="mt-4">المستويات:</h4>
          <div id="detailLevels" class="levels-grid"></div>
          
          <h4 class="mt-4">امتحانات المستويات:</h4>
          <div id="examsTableWrapper" class="table-container"></div>
          
          <h4 class="mt-4">تلخيصات الطالب:</h4>
          <div class="form-group">
            <label for="summaryFilterStatus" class="form-label">تصفية حسب الحالة:</label>
            <select id="summaryFilterStatus" class="form-control form-select" onchange="filterSummariesTable()">
              <option value="all">الكل</option>
              <option value="submitted">تم التسليم</option>
              <option value="draft">مسودة</option>
            </select>
          </div>
          <div id="summariesTableWrapper" class="table-container"></div>
          
          <!-- Summary Details Box -->
          <div id="summaryDetailsBox" class="card mt-3" style="display: none;">
            <div class="card-header">
              <h4 id="summaryDetailsTitle"></h4>
            </div>
            <div class="card-content">
              <div class="form-group">
                <label class="form-label">نص التلخيص:</label>
                <div id="summaryDetailsContent" class="form-control" style="min-height: 100px; background-color: var(--background);"></div>
              </div>
              <div class="form-group">
                <label for="summaryDetailsComment" class="form-label">تعليق المعلم:</label>
                <textarea id="summaryDetailsComment" class="form-control" placeholder="اكتب تعليقك هنا..."></textarea>
                <button class="btn mt-2" id="saveSummaryDetailsCommentBtn">حفظ التعليق</button>
              </div>
              <div id="studentReplySection" class="form-group" style="display: none;">
                <label class="form-label">رد الطالب:</label>
                <div id="summaryDetailsStudentReply" class="form-control" style="min-height: 60px; background-color: var(--background);"></div>
                <button class="btn btn-danger mt-2" id="clearStudentReplyBtn">مسح رد الطالب</button>
              </div>
              <div class="form-group">
                <label for="summaryDetailsMark" class="form-label">تعديل العلامة:</label>
                <input type="number" id="summaryDetailsMark" class="form-control" min="0" max="100" placeholder="العلامة">
                <button class="btn mt-2" id="saveSummaryDetailsMarkBtn">حفظ العلامة</button>
              </div>
            </div>
            <div class="card-actions">
              <button class="btn btn-danger" onclick="hideSummaryDetails()">إغلاق</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lessons Management Card -->
    <div class="card mt-3">
      <div class="card-header">
        <h3>قائمة الدروس</h3>
      </div>
      <div class="card-content">
        <div id="editLessonMsg" class="mb-3"></div>
        <div class="table-container">
          <table class="table" id="lessonsTable">
            <thead>
              <tr>
                <th>رقم الدرس</th>
                <th>العنوان</th>
                <th>رابط الدرس</th>
                <th>الصوت</th>
                <th>المستوى</th>
                <th>تعديل</th>
                <th>حذف</th>
              </tr>
            </thead>
            <tbody id="lessonsList"></tbody>
          </table>
        </div>
      </div>
    </div>
  </main>

  <!-- JavaScript (Keep all your existing JS code as is) -->
  <script>
    // All your existing JavaScript code remains exactly the same
    // Only the CSS and HTML structure has been modified
    // The functionality remains identical
  </script>
</body>
</html>
